(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{57:function(e,t,n){e.exports=n(76)},62:function(e,t,n){},63:function(e,t,n){},76:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(50),i=n.n(o),c=(n(62),n(7)),u=n(55),l=n(14),s=n(54),d=(n(63),n(15)),f=n.n(d),p=n(18),h=n(21),b=n(22),m=n(23),v=n(9),g=n.n(v),E=(n(46),function(){function e(){Object(b.a)(this,e),this._db=void 0,this._db=g.a.firestore()}return Object(m.a)(e,[{key:"createGroup",value:function(){var e=Object(h.a)(f.a.mark(function e(t){var n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._db.collection("groups").add(t);case 2:return n=e.sent,e.abrupt("return",Object(p.a)({},t,{id:n.id}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addGroupMember",value:function(e,t){return this._db.collection("groups").doc(e).update({users:g.a.firestore.FieldValue.arrayUnion(t)})}},{key:"getGroupMembership",value:function(e){return this._db.collection("groups").where("users","array-contains",e).get().then(function(e){return e.docs.map(function(e){return Object(p.a)({},e.data(),{id:e.id})})})}}]),e}()),O=n(3),j=function(){function e(){Object(b.a)(this,e),this._db=void 0,this._db=g.a.firestore()}return Object(m.a)(e,[{key:"subscribe",value:function(e,t){var n=this;return O.a.create(function(t){return n._db.collection("destinations").where("groupId","==",e).onSnapshot(function(e){var n=[];e.forEach(function(e){return n.push(Object(p.a)({id:e.id},e.data()))}),t.next(n)})}).subscribe(t)}},{key:"createDestination",value:function(){var e=Object(h.a)(f.a.mark(function e(t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._db.collection("destinations").add(t);case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteDestination",value:function(e){return this._db.collection("destinations").doc(e).delete()}}]),e}(),w=(n(40),n(78)),k=n(79),y=n(80),C=function(){function e(){var t=this;Object(b.a)(this,e),this._groupRepo=new E,this.firebaseAuth=void 0,this.currentUser$=void 0,this.firebaseAuth=g.a.auth(),this.currentUser$=new O.a(function(e){t.firebaseAuth.onAuthStateChanged(function(t){e.next(t)})}).pipe(Object(w.a)(function(e){return null==e?[null]:new O.a(function(n){t._groupRepo.getGroupMembership(e.uid).then(function(t){return n.next(Object(p.a)({},e,{groups:t}))},function(t){console.error("error fetching groups",t),n.next(Object(p.a)({},e,{groups:[]}))})})}),Object(k.a)(null),Object(y.a)())}return Object(m.a)(e,[{key:"signOut",value:function(){var e=Object(h.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.firebaseAuth.signOut();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}();function A(e,t){return e.localeCompare(t)}function x(e){var t,n=e.groupId,r=e.destinations,o=e.onCreate,i=e.onDelete,c=r.slice().sort((t=function(e){return e.name},function(e,t){return function(n,r){return e(t(n),t(r))}}(A,t))).map(function(e){return a.a.createElement("li",{key:e.name},a.a.createElement("button",{onClick:function(){return i(e)}},"delete")," "+e.name)});return a.a.createElement("div",null,a.a.createElement("ul",null,c),"Add new:",a.a.createElement("br",null),a.a.createElement(S,{groupId:n,onAdd:o}))}function S(e){var t=e.groupId,n=e.onAdd,o=Object(r.useState)(""),i=Object(c.a)(o,2),u=i[0],l=i[1],s=function(){n({groupId:t,name:u}),l("")};return a.a.createElement("div",null,a.a.createElement("label",null,"Name"),a.a.createElement("input",{value:u,onChange:function(e){l(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&s()}}),a.a.createElement("button",{onClick:s},"Add"))}function I(e){var t=e.destinations,n=Object(r.useState)(),o=Object(c.a)(n,2),i=o[0],u=o[1];return t&&t.length?a.a.createElement("div",null,a.a.createElement("button",{onClick:function(){var e=t.map(function(e){return{dest:e,sort:Math.random()}}).reduce(function(e,t){return e.sort>t.sort?e:t}).dest;u(e)}},"Pick")," ",i&&i.name||"\xa0"):a.a.createElement("div",null)}var _=n(51),D=a.a.createContext(null);function N(e){var t=e.authService;if(null!=Object(r.useContext)(D))return a.a.createElement(l.a,{to:{pathname:"/"}});var n={signInFlow:"popup",signInOptions:[g.a.auth.GoogleAuthProvider.PROVIDER_ID,g.a.auth.PhoneAuthProvider.PROVIDER_ID],callbacks:{signInSuccessWithAuthResult:function(){return!1}}};return a.a.createElement(_.FirebaseAuth,{uiConfig:n,firebaseAuth:t.firebaseAuth})}var P=a.a.createContext(null);function R(e){var t=e.user,n=e.onSelect,o=Object(r.useState)(t.groups[0]),i=Object(c.a)(o,2),u=i[0],l=i[1];if(!t.groups.length)return a.a.createElement("p",null,"User '",t.displayName,"' is not a member of any groups.");var s=t.groups.map(function(e){return a.a.createElement("option",{value:e.id},e.name)});return a.a.createElement("div",null,a.a.createElement("p",null,"no group selected"),a.a.createElement("select",{value:u&&u.id||"",onChange:function(e){var n=t.groups.find(function(t){return t.id===e.target.value});l(n||null)}},s),a.a.createElement("button",{onClick:function(){u&&n(u)}},"Switch"))}function U(e){var t=e.onCreate,n=Object(r.useState)(""),o=Object(c.a)(n,2),i=o[0],u=o[1],l=Object(r.useState)(!1),s=Object(c.a)(l,2),d=s[0],f=s[1],p=Object(r.useContext)(D),h=Object(r.useState)(null),b=Object(c.a)(h,2),m=b[0],v=b[1],g=!i.length||d;return a.a.createElement("div",null,a.a.createElement("div",null,a.a.createElement("input",{value:i,onChange:function(e){return u(e.target.value)}}),a.a.createElement("button",{disabled:g,onClick:function(){i&&p&&(f(!0),(new E).createGroup({name:i,users:[p.uid]}).then(t,v).finally(function(){return f(!1)}))}},"Create")),m)}g.a.initializeApp({apiKey:"AIzaSyAZv3xYRqBQTuPN02gy6zz25C0LUgpZ6zU",authDomain:"lunchtime-react-95b31.firebaseapp.com",projectId:"lunchtime-react-95b31"}),console.log("DestinationRepository",j);var G=new j,W=new C;function z(e){var t=e.component,n=Object(u.a)(e,["component"]),o=t,i=Object(r.useContext)(D);return a.a.createElement(l.b,Object.assign({},n,{render:function(e){return i?a.a.createElement(o,e):a.a.createElement(l.a,{to:{pathname:"/sign-in",state:{from:e.location}}})}}))}function L(){var e=Object(r.useContext)(D),t=Object(r.useState)(null),n=Object(c.a)(t,2),o=n[0],i=n[1],u=Object(r.useState)(null),l=Object(c.a)(u,2),s=l[0],d=l[1];if(Object(r.useEffect)(function(){if(o){var e=G.subscribe(o.id,{next:d});return function(){return e.unsubscribe()}}},[e,o]),null==o)return a.a.createElement(a.a.Fragment,null,a.a.createElement(R,{user:e,onSelect:i}),a.a.createElement(U,{onCreate:i}));if(null==s)return a.a.createElement("p",null,"Loading data...");return a.a.createElement(P.Provider,{value:o},a.a.createElement("h1",null,"Pick a place"),a.a.createElement(I,{destinations:s}),a.a.createElement("h1",null,"Edit places"),a.a.createElement(x,{groupId:o.id,destinations:s,onCreate:function(e){G.createDestination(e)},onDelete:function(e){G.deleteDestination(e.id)}}))}var F=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function M(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(a.a.createElement(function(){var e=Object(r.useState)(null),t=Object(c.a)(e,2),n=t[0],o=t[1];Object(r.useEffect)(function(){var e=W.currentUser$.subscribe(o);return function(){return e.unsubscribe()}},[]);var i=n?a.a.createElement("p",null,"Signed in as: ",n.displayName,a.a.createElement("button",{onClick:function(){W.signOut()}},"Sign out")):null;return a.a.createElement(s.a,null,a.a.createElement("div",{className:"App"},a.a.createElement("header",{className:"App-header"},a.a.createElement("h1",{className:"App-title"},"Lunchtime")),a.a.createElement("div",{className:"App-body-container"},a.a.createElement("div",{className:"App-body"},i,a.a.createElement(D.Provider,{value:n},a.a.createElement(l.d,null,a.a.createElement(z,{exact:!0,path:"/",component:L}),a.a.createElement(l.b,{path:"/sign-in",render:function(e){return a.a.createElement(N,{authService:W})}})))))))},null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");F?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):M(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):M(e)})}}()}},[[57,1,2]]]);
//# sourceMappingURL=main.999fa3f4.chunk.js.map